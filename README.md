# MangaLib Downloader v2.0

Асинхронный загрузчик манги с MangaLib с поддержкой метаданных для Komga/Mylar.

![PoC](https://files.catbox.moe/udsxff.webp)

## Структура проекта

```
manga_downloader/
├── config.py          # Конфигурация приложения
├── colors.py          # Цветной вывод в консоль
├── models.py          # Модели данных
├── api_client.py      # API клиент для MangaLib
├── metadata.py        # Генерация метаданных (ComicInfo.xml, series.json)
├── downloader.py      # Основная логика скачивания
├── main.py            # Точка входа
├── requirements.txt   # Зависимости
└── README.md          # Документация
```

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Использование

1. Откройте `main.py`
2. Настройте параметры в секции `КОНФИГУРАЦИЯ`:

```python
cfg = Config(
    manga_slug="114307--kaoru-hana-wa-rinto-saku",
    chapter_range=(54, 80),  # диапазон глав
    series_title_override="Kaoru Hana Wa Rin To Saku",
    
    # Параметры производительности
    max_concurrent_chapters=3,  # 1-5
    max_concurrent_images=3,    # 2-10
    request_delay=0.5,          # 0.5-5 секунд
)
```

3. Запустите:
```bash
python main.py
```

## Параметры конфигурации

### Основные параметры

- **manga_slug** - идентификатор манги из URL (например, `114307--kaoru-hana-wa-rinto-saku`)
- **chapter_range** - диапазон глав для скачивания `(начало, конец)`
- **series_title_override** - переопределение названия серии (опционально)

### Параметры производительности

- **max_concurrent_chapters** - количество одновременно скачиваемых глав (рекомендуется: 1-5)
- **max_concurrent_images** - количество одновременно скачиваемых изображений (рекомендуется: 2-10)
- **request_delay** - задержка между запросами в секундах (рекомендуется: 0.5-5)

### Дополнительные параметры

- **volume_override** - принудительное указание тома (если автоопределение не работает)
- **output_dir** - директория для сохранения файлов
- **cleanup_temp** - удалять временные файлы после завершения
- **fallback_volume_range** - диапазон томов для автоопределения

## Структура выходных файлов

```
downloads/
└── Series_Name.zip
    └── Series_Name/
        ├── ComicInfo.xml          # Метаданные серии
        ├── series.json            # Метаданные для Komga/Mylar
        ├── cover.jpg              # Обложка серии (+ другие варианты)
        └── Volume 01/
            ├── ComicInfo.xml      # Метаданные тома
            ├── Chapter 001.cbz    # Глава в формате CBZ
            ├── Chapter 002.cbz
            └── ...
```

### Формат CBZ

Каждый файл `.cbz` содержит:
- Изображения страниц (001.jpg, 002.jpg, ...)
- `ComicInfo.xml` - метаданные главы
- `info.txt` - дополнительная информация в JSON

## Возможности

- Асинхронное скачивание с контролем параллелизма
- Автоматическое определение томов
- Обработка rate limits (429)
- Повторные попытки при ошибках
- Прогресс-бары для отслеживания
- Метаданные для Komga/Mylar/Kavita
- Цветной вывод в консоль
- Модульная архитектура

## Примечания

- При высоких значениях `max_concurrent_*` возможны rate limits (429)
- Увеличьте `request_delay` если получаете ошибки 403/429
- Для корректной работы требуется стабильное интернет-соединение

## Troubleshooting

**Ошибка 429 (Too Many Requests)**
- Увеличьте `request_delay`
- Уменьшите `max_concurrent_images`

**Ошибка 403 (Forbidden)**
- Скрипт автоматически прогревает сессию
- Если проблема сохраняется, увеличьте `request_delay`

**Не удается определить том**
- Используйте параметр `volume_override`
- Или расширьте `fallback_volume_range`

---

Этот инструмент предназначен только для образовательных целей. Пожалуйста, уважайте авторские права и условия использования MangaLib.